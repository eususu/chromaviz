import { useEffect, useState, createContext } from 'react'
import BarLoader from "react-spinners/ClipLoader";
import './App.css'
import ThreePointVis from './ThreePointViz';
import Footer from './Footer';

function App() {

  const [data, setData] = useState([[]])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState(null)

  const [settings, setSettings] = useState({showDocuments:true, showMetadata: true, showLines: true})
  const [search_keyword, setSearchKeyword] = useState(null)
  
  

  useEffect(() => {
    setLoading(true)
    setData({})
    fetch(`http://127.0.0.1:5000/data`)
      .then(res => res.json())
      .then(
        (result) => {
          setLoading(false);
          setData(result);
        },
        // Note: it's important to handle errors here
        // instead of a catch() block so that we don't swallow
        // exceptions from actual bugs in components.
        (error) => {
          setLoading(false);
          setError(error);
        }
      )
    //const j = '{"points":[{"position":[1.048135757446289,-0.21178962290287018,0.777496337890625],"document":"국제 운항 노선에 관한 정보를 얻기 위해 어디로 연락해야 하며, 연락 가능한 시간은 언제인가요","metadata":{"seq_num":15,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadee0-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[-0.36481013894081116,-0.12383083254098892,-1.9892196655273438],"document":"김해공항 화물청사의 연락처와 업무시간을 알려주실 수 있나요","metadata":{"seq_num":16,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadf08-eb4e-11ee-94d8-00155d11fc92","group":4},{"position":[-0.0420723557472229,-0.683492124080658,-2.0287203788757324],"document":"김해공항에서 아시아나항공을 이용해 보낸 국내화물의 도착 문의를 위해 어느 번호로 연락해야 하나요","metadata":{"seq_num":17,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadf1c-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[1.0068787336349487,-1.5822386741638184,0.2808729112148285],"document":"대한항공의 국내화물도착 서비스 문의와 아시아나항공은 같은 전화번호를 사용하나요","metadata":{"seq_num":18,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadf30-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[0.32438722252845764,1.8058751821517944,0.6366875171661377],"document":"아시아나항공의 국내화물도착 서비스를 제공하는 시간은 언제인가요","metadata":{"seq_num":19,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadf4e-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[-0.16238053143024445,-0.5478895306587219,-1.9327391386032104],"document":"김해공항 아시아나항공의 화물도착 서비스 문의 시 사용하는 취급 대리점 연락처를 알려주세요.","metadata":{"seq_num":20,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadf62-eb4e-11ee-94d8-00155d11fc92","group":5},{"position":[0.07976493239402771,0.04528849199414253,0.376013845205307],"document":"제주공항에서 대한항공을 이용하여 국내화물을 어느 노선으로 보낼 수 있나요","metadata":{"seq_num":21,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadf76-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[1.0380553007125854,-1.5452250242233276,0.28247374296188354],"document":"대한항공의 국내화물출발 서비스에 대해 문의하고 싶을 때 어떤 번호로 전화를 걸어야 하나요","metadata":{"seq_num":22,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadf8a-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[0.48939868807792664,0.161322683095932,0.7787925601005554],"document":"제주공항의 대한항공 국내화물 서비스 문의 전화는 언제 가능한가요","metadata":{"seq_num":23,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadfa8-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[0.455214262008667,1.5425037145614624,0.6258429884910583],"document":"제주공항에서 김포나 김해로 화물을 보내려면 어떤 시간대에 대한항공 사무실에 연락해야 하나요","metadata":{"seq_num":24,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadfbc-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[0.3500061333179474,-0.10164617747068405,0.8822481036186218],"document":"제주공항에서 이용할 수 있는 국제화물출발 서비스의 연락처가 무엇인가요","metadata":{"seq_num":25,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadfd0-eb4e-11ee-94d8-00155d11fc92","group":5},{"position":[0.6535083651542664,1.0519517660140991,0.3462601900100708],"document":"제주공항 국제화물출발 서비스의 업무시간은 언제인가요","metadata":{"seq_num":26,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadfe4-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[0.41256189346313477,-0.08119314163923264,0.8647637963294983],"document":"제주공항의 국제화물 관련 문의를 위해 어느 번호로 전화해야 하나요","metadata":{"seq_num":27,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcadff8-eb4e-11ee-94d8-00155d11fc92","group":5},{"position":[0.4376235008239746,0.13500317931175232,0.8009600043296814],"document":"제주공항 국제화물출발 서비스에 대한 정보를 원하는데, 언제 연락을 취하는 것이 좋을까요","metadata":{"seq_num":28,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae00c-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[0.07009276747703552,0.0335562601685524,0.368698388338089],"document":"제주공항에서 이용할 수 있는 아시아나항공의 국내화물 출발 서비스의 목적지는 어디인가요","metadata":{"seq_num":29,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae020-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[0.3840077221393585,-0.09989316016435623,0.8609201908111572],"document":"제주공항의 아시아나항공 국내화물출발 서비스 문의를 위한 연락처는 무엇인가요","metadata":{"seq_num":30,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae03e-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[0.6528019309043884,1.0550135374069214,0.3054637014865875],"document":"아시아나항공의 제주공항 화물운송 서비스 이용 가능한 업무시간은 언제인가요","metadata":{"seq_num":31,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae052-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[0.02756367065012455,0.008277676068246365,0.45254695415496826],"document":"개인화물을 제주공항 아시아나항공을 통해 보내려면 어떤 절차를 거쳐야 하나요","metadata":{"seq_num":32,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae066-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[0.22888237237930298,-0.04971514269709587,0.8717822432518005],"document":"제주공항에서 이용할 수 있는 다른 국제화물출발 서비스의 연락처를 알고 싶어요. 어떻게 연락할 수 있나요","metadata":{"seq_num":33,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae07a-eb4e-11ee-94d8-00155d11fc92","group":5},{"position":[0.6510476469993591,1.0501471757888794,0.3552889823913574],"document":"제주공항의 국제화물출발 서비스는 몇 시부터 몇 시까지 운영되나요","metadata":{"seq_num":34,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae098-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[0.6718223690986633,1.0053491592407227,0.39257216453552246],"document":"제주공항 국제화물출발 서비스의 업무시간이 궁금해요, 알려주실 수 있나요","metadata":{"seq_num":35,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae0ac-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[0.449097603559494,0.1306184083223343,0.7996876835823059],"document":"언제 제주공항으로 전화해서 국제화물출발 서비스에 대한 문의를 할 수 있나요","metadata":{"seq_num":36,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae0c0-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[0.10043720155954361,0.03007533960044384,0.40847739577293396],"document":"제주공항에서 제주항공을 이용할 때 어떤 도시로 화물을 보낼 수 있나요","metadata":{"seq_num":37,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae0d4-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[0.3540262281894684,-0.13922367990016937,0.8941318392753601],"document":"제주공항의 제주항공 화물운송 서비스 연락처는 무엇인가요","metadata":{"seq_num":38,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae0e8-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[0.6431542038917542,1.0579999685287476,0.3039308786392212],"document":"제주공항에서 제주항공 화물 서비스의 운영 시간은 언제인가요","metadata":{"seq_num":39,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae0fc-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[0.1056201234459877,0.0354522243142128,0.43414318561553955],"document":"제주공항의 제주항공을 통해 개인 화물도 보낼 수 있나요","metadata":{"seq_num":40,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae110-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[0.20972032845020294,-0.06365849077701569,0.40582528710365295],"document":"제주공항에서 티웨이항공을 이용해 대구로 화물을 보낼 수 있나요","metadata":{"seq_num":41,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae12e-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[1.0957292318344116,-1.1422200202941895,0.5306597352027893],"document":"티웨이항공 국내화물출발 서비스의 연락처가 어떻게 되나요","metadata":{"seq_num":42,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae142-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[0.6976527571678162,1.4979310035705566,-0.6532573103904724],"document":"제주공항의 티웨이항공 국내화물 서비스 운영 시간이 언제인가요","metadata":{"seq_num":43,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae156-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[0.7067677974700928,1.4980401992797852,-0.6455405354499817],"document":"제주공항에서 이용 가능한 티웨이항공 국내화물 서비스의 업무시간은 영진항공 기준으로 어떻게 되나요","metadata":{"seq_num":44,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae16a-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[0.2073592096567154,-0.06837151199579239,0.8901787400245667],"document":"제주공항에서 국내 화물 도착 서비스를 담당하는 업체와 그 연락처를 알려주세요.","metadata":{"seq_num":45,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae17e-eb4e-11ee-94d8-00155d11fc92","group":5},{"position":[0.6567996144294739,1.0345503091812134,0.4026183784008026],"document":"제주공항의 인성항공물류가 운영하는 국내화물도착 서비스 이용 가능 시간은 언제인가요","metadata":{"seq_num":46,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae192-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[0.41823485493659973,0.6029977798461914,0.66008460521698],"document":"제주공항에서 주말과 공휴일에도 국내화물도착 서비스를 이용할 수 있나요","metadata":{"seq_num":47,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae1b0-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[-0.006757918279618025,-0.004845913965255022,0.44183364510536194],"document":"인성항공물류에서 처리하는 제주공항의 국내화물을 수령하려면 어떻게 해야 하나요","metadata":{"seq_num":48,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae1c4-eb4e-11ee-94d8-00155d11fc92","group":0},{"position":[0.21747957170009613,-0.07727840542793274,0.43805864453315735],"document":"대구공항에서 제주로 티웨이항공을 통해 화물을 보내려면 어디로 연락해야 하나요","metadata":{"seq_num":49,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae1d8-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[0.709744393825531,1.489611029624939,-0.6102415323257446],"document":"대구공항 티웨이항공 국내화물출발 서비스의 업무시간은 어떻게 되나요","metadata":{"seq_num":50,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae1ec-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[1.2300989627838135,-1.306628942489624,0.3003023564815521],"document":"인성항공물류에 연락하려면 어떤 전화번호를 사용해야 하나요","metadata":{"seq_num":51,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae200-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[0.7225624918937683,1.4921623468399048,-0.5913974642753601],"document":"대구공항의 티웨이항공 국내화물출발 서비스는 주말과 공휴일에도 이용할 수 있나요","metadata":{"seq_num":52,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae214-eb4e-11ee-94d8-00155d11fc92","group":34},{"position":[0.6629520058631897,-0.4100351631641388,0.3631021976470947],"document":"울산공항에서 대한항공을 이용해 국내에서 울산으로 오는 화물을 수령할 수 있나요","metadata":{"seq_num":53,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae228-eb4e-11ee-94d8-00155d11fc92","group":23},{"position":[0.6637240648269653,-0.41778960824012756,0.3551332950592041],"document":"울산공항에서 대한항공을 통해 화물을 발송하고 싶은데 가능한가요","metadata":{"seq_num":54,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae23c-eb4e-11ee-94d8-00155d11fc92","group":23},{"position":[0.10640739649534225,-0.5071962475776672,-0.6651487946510315],"document":"울산공항 대한항공 카운터의 연락처를 알려줄 수 있나요","metadata":{"seq_num":55,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae25a-eb4e-11ee-94d8-00155d11fc92","group":7},{"position":[0.5010102987289429,0.28211989998817444,-1.627050518989563],"document":"울산공항 대한항공 카운터의 업무 시간은 언제인가요","metadata":{"seq_num":56,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae26e-eb4e-11ee-94d8-00155d11fc92","group":2},{"position":[0.3104006350040436,-0.15774939954280853,0.10330695658922195],"document":"여수공항에서 아시아나항공을 통해 국내도착화물 서비스를 이용할 수 있는 노선은 무엇인가요","metadata":{"seq_num":57,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae282-eb4e-11ee-94d8-00155d11fc92","group":35},{"position":[0.3210200071334839,-0.2180871218442917,0.14139504730701447],"document":"여수공항에서 여수 출발 항공화물을 발송할 수 있나요","metadata":{"seq_num":58,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae2aa-eb4e-11ee-94d8-00155d11fc92","group":35},{"position":[0.23000024259090424,0.22380150854587555,-0.2147684246301651],"document":"여수공항 내 아시아나항공 국내도착화물 서비스의 업무시간은 얼마나 됩니까","metadata":{"seq_num":59,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae2be-eb4e-11ee-94d8-00155d11fc92","group":1},{"position":[0.9810716509819031,-1.592311978340149,0.27847161889076233],"document":"여수공항 아시아나항공 국내도착화물 서비스에 연락하려면 어떤 번호로 전화해야 하나요","metadata":{"seq_num":60,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae2d2-eb4e-11ee-94d8-00155d11fc92","group":35},{"position":[1.0905905961990356,-0.833117663860321,-0.8011975288391113],"document":"청주공항에서는 항공화물 운송 서비스를 이용할 수 있나요","metadata":{"seq_num":61,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae2e6-eb4e-11ee-94d8-00155d11fc92","group":43},{"position":[1.9576281309127808,-0.1858365386724472,0.5540796518325806],"document":"군산공항에서 물건을 비행기로 보내고 싶은데 가능한가요","metadata":{"seq_num":62,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae304-eb4e-11ee-94d8-00155d11fc92","group":0},{"position":[0.2736622095108032,-0.48709866404533386,-0.12741881608963013],"document":"양양공항은 화물을 항공기로 보낼 수 있는 곳인가요","metadata":{"seq_num":63,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae318-eb4e-11ee-94d8-00155d11fc92","group":33},{"position":[0.32455915212631226,-0.5638909935951233,0.18206262588500977],"document":"포항공항을 통해 상품을 항공화물로 배송할 수 있나요","metadata":{"seq_num":64,"source":"/mnt/d/my/ai/triai/data/class1/항공화물_질답.json"},"id":"0fcae32c-eb4e-11ee-94d8-00155d11fc92","group":6}]}'
    //setData(JSON.parse(j))
    //setLoading(false);
  }, [])

  return (
    <>
    {loading &&
    <div style={{
      position: 'absolute', left: '50%', top: '50%',
      transform: 'translate(-50%, -50%)'
  }}>
      <BarLoader
        size={150}
        aria-label="Loading Spinner"
        data-testid="loader"
      /></div>
    }
    { !loading && <>
    <div className="vis-container">
        <ThreePointVis data={data} settings={[settings, setSettings]} search_keyword={search_keyword}/>
      </div>
    
    <Footer settings={[settings, setSettings]} search_keyword={[search_keyword, setSearchKeyword]}></Footer></>
    }
    </>
    
  )
}

export default App
